// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

// //////////////////////////////////////////////////
// // âœ… 2024 Prisma
// // âœ… 7-0. Setup 

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "sqlite"
//   url      = env("DATABASE_URL")
// }

// //////////////////////////////////////////////////
// // âœ… 2024 Prisma
// // âœ… 7-1. Schemas 

// // ğŸ”¶ Prismaì—ê²Œ ìš°ë¦¬ DBì— ìˆëŠ” ì‚¬ìš©ìê°€ ì–´ë–¤ í˜•íƒœì¸ì§€ ì„¤ëª…

// generator client {
//   provider = "prisma-client-js"
// }

// // sqliteì„ ì´ìš©í•´ì„œ ì‘ì—…í•˜ê³ , Prismaì—ê²Œ ìš°ë¦¬ DB ê°€ ì–´ë”” ìˆëŠ”ì§€ ì•Œë ¤ì£¼ê³ 
// datasource db {
//   provider = "sqlite"
//   url      = env("DATABASE_URL")
// }

// // ë°ì´í„° ê´€ì ì—ì„œ, ìš°ë¦¬ì˜ ì‚¬ìš©ìê°€ ì–´ë–»ê²Œ ìƒê²¼ëŠ”ì§€ ì•Œë ¤ì¤Œ
// // ğŸ”¶ í…Œì´ë¸” User - í…Œì´ë¸”ì„ ëª¨ë¸ì´ë¼ê³ ë„ í•  ìˆ˜ ìˆëŠ”ë° ì¹´í…Œê³ ë¦¬ì²˜ëŸ¼ ë„¤ DB ì•ˆì— ìˆëŠ” ê°ì²´ ê°™ì€ ê²ƒì´ë‹¤
// // linter : ì—ëŸ¬ë¥¼ ë°œìƒ ì‹œí‚´. DB ì— ìˆëŠ” ëª¨ë¸ì€ ìµœì†Œí•œ, í•œ ê°œì˜ ê³ ìœ í•œ ê¸°ì¤€ì„ ê°€ì ¸ì•¼ í•œë‹¤
// // ê¸°ë³¸ì ìœ¼ë¡œ ê³ ìœ í•œ ì‹ë³„ìê°€ í•„ìš”í•¨. ì–´ë–»ê²Œ í•œ ì‚¬ìš©ìë¥¼ ë‹¤ë¥¸ ì‚¬ìš©ìì™€ êµ¬ë³„í•  ìˆ˜ ìˆë‚˜?

// // ğŸ”¹ id         Int      @id @default(autoincrement()) 
// // DBì— ìˆëŠ” ëª¨ë¸ì€ ìµœì†Œí•œ, í•œ ê°œì˜ ê³ ìœ í•œ ê¸°ì¤€ì„ ê°€ì ¸ì•¼ í•¨
// // ê¸°ë³¸ì ìœ¼ë¡œ ê³ ìœ í•œ ì‹ë³„ìê°€ í•„ìš”í•¨
// // ì‚¬ìš©ìê°€ idë¥¼ ê°–ê³ 
// // ê·¸ idëŠ” ìˆ«ìê°€ ë  ê²ƒì´ê³ , intì´ë¼ê³  í•¨
// // ê·¸ë¦¬ê³  ì´ê²ƒì´ idë¼ê³  ì•Œë ¤ì£¼ëŠ” ì†ì„± ì¶”ê°€
// // autoincrement() ê¸°ë³¸ ê°’ ì¶”ê°€ 
// // ì²« ë²ˆì§¸ ì‚¬ìš©ìë¥¼ ìƒì„±í•  ë•Œ, ê·¸ ì²« ë²ˆì§¸ ì‚¬ìš©ìì˜ idëŠ” ìë™ìœ¼ë¡œ 1ì´ ë  ê²ƒì´ë‹¤

// // ğŸ”¹ username   String   @unique
// // ì‚¬ìš©ì ì´ë¦„ì€ stringì´ ë ê²ƒì´ê³ , ê³ ìœ í•œ ê°’ì´ ë˜ì–´ì•¼ í•¨
// // ë™ì¼í•œ ì´ë¦„ì˜ ë‘ ì‚¬ìš©ìë¥¼ ê°€ì§ˆ ìˆ˜ ì—†ë‹¤

// // ğŸ”¹ email      String?  @unique
// // ì´ë©”ì¼, String í•˜ì§€ë§Œ ì‚¬ìš©ìê°€ í•¸ë“œí° ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ í•˜ëŠ” ê²½ìš°ë„ ìˆìœ¼ë‹ˆ ì˜µì…”ë„ì¸ ? ë¬¼ìŒí‘œ ì¶”ê°€
// // ì´ë©”ì¼ì€ í•„ìˆ˜ê°€ ì•„ë‹ˆë‹¤. ì´ë©”ì¼ë„ ê³ ìœ ê°’ì´ ë˜ì–´ì•¼ í•¨

// // ğŸ”¹ password   String?
// // ì‚¬ìš©ìê°€ ì´ë©”ì¼ì„ í†µí•´ ê°€ì…í•œë‹¤ë©´ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥. ë¹„ë°€ë²ˆí˜¸ë„ í•„ìˆ˜ê°€ ì•„ë‹˜ (sms, ê¹ƒí—ˆë¸Œ ë“± ë¹„ë°€ë²ˆí˜¸ í•„ìš” ì—†ìŒ)

// // ğŸ”¹ phone      String?  @unique
// // phoneì€ String ì‚¬ìš©ìê°€ +82010... ì´ëŸ°ì‹ìœ¼ë¡œ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ê¸¸ ì›í•˜ê¸° ë•Œë¬¸
// // í•„ìˆ˜ ê°’ ì•„ë‹˜ (ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸ í•œë‹¤ë©´).
// // ë§Œì•½ ì „í™”ë²ˆí˜¸ë¥¼ ì…ë ¥í•œë‹¤ë©´ ë²ˆí˜¸ëŠ” ê³ ìœ ê°’ì´ì–´ì•¼ í•¨

// // ğŸ”¹ github_id  String?  @unique
// // ê¹ƒí—ˆë¸Œ ë¡œê·¸ì¸, string, ì•„ì´ë””ëŠ” ê³ ìœ í•´ì•¼ í•¨

// // ğŸ”¹ avatar     String? // @default("http://dkdkdkdkdk.com/dkd.jpg") ê¸°ë³¸ ê°’ ê°€ëŠ¥
// // ì´ë¯¸ì§€ ì—…ë¡œë“œ í• ê±°ë¼ ì•„ë°”íƒ€ ìˆì–´ì•¼ í•¨. ë§Œì•½ ê¹ƒí—ˆë¸Œë¡œ ê°€ì…í–ˆë‹¤ë©´ ê³„ì •ì—ì„œ ì•„ë°”íƒ€ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆìŒ. ê·¸ë˜ì„œ í•„ìˆ˜ëŠ” ì•„ë‹˜.

// // ğŸ”¹ created_at DateTime @default(now())
// // ì‚¬ìš©ìê°€ ì–¸ì œ ìƒì„±ë˜ì—ˆëŠ”ì§€ ì•Œê³  ì‹¶ìŒ. now() ì´ í•¨ìˆ˜ëŠ” ì‚¬ìš©ìê°€ ìƒì„±ë  ë•Œì˜ í˜„ì¬ ì‹œê°„ì„ ê°€ì ¸ì˜´

// // ğŸ”¹ updated_at DateTime @updatedAt
// // ì‚¬ìš©ìê°€ ì–¸ì œ ì—…ë°ì´íŠ¸ ë˜ì—ˆëŠ”ì§€ ì•Œê³  ì‹¶ë‹¤
// // @updatedAt ì‚¬ìš©ìê°€ ìˆ˜ì •ë  ë•Œë§ˆë‹¤ PrismaëŠ” ì‚¬ìš©ìì˜ ë ˆì½”ë“œê°€ ìˆ˜ì •ëœ ì‹œê°„ì„ updated at ì†ì„±ì— ë„£ì„ ê²ƒì„

// model User {
//   id         Int      @id @default(autoincrement())
//   username   String   @unique
//   email      String?  @unique
//   password   String?
//   phone      String?  @unique
//   github_id  String?  @unique
//   avatar     String? // @default("http://dkdkdkdkdk.com/dkd.jpg") ê¸°ë³¸ ê°’ ê°€ëŠ¥
//   created_at DateTime @default(now())
//   updated_at DateTime @updatedAt
// }

// //////////////////////////////////////////////////
// // âœ… 2024 Prisma
// // âœ… 7-4. Relationships
// // ğŸ”¶ SMSToken ëª¨ë¸ ë§Œë“¤ê¸°
// // ì´ ëª¨ë¸ì€ User ëª¨ë¸ê³¼ ì—°ê²° ë¨. ê·¸ë¦¬ê³  SMS ì¸ì¦ì„ ìœ„í•´ì„œ ì‚¬ìš©í•  ê²ƒì„

// generator client {
//   provider = "prisma-client-js"
// }

// datasource db {
//   provider = "sqlite"
//   url      = env("DATABASE_URL")
// }

// model User {
//   id         Int        @id @default(autoincrement())
//   username   String     @unique
//   email      String?    @unique
//   password   String?
//   phone      String?    @unique
//   github_id  String?    @unique
//   avatar     String? // @default("http://dkdkdkdkdk.com/dkd.jpg") ê¸°ë³¸ ê°’ ê°€ëŠ¥
//   created_at DateTime   @default(now())
//   updated_at DateTime   @updatedAt
//   SMSToken   SMSToken[]
// }

// // ğŸ”¹ SMSToken
// // ğŸ“ id, created at, updated at ë¥¼ ë³µì‚¬
// // ì´ê²ƒë“¤ì€ ì‚¬ìš©í•˜ì§€ ì•Šë”ë¼ë„ ê°–ê³  ìˆëŠ” ê²ƒì´ ì¢‹ë‹¤

// // ğŸ”¶ ëª¨ë¸ ê°„ì˜ ê´€ê³„ë¥¼ ìƒì„±í•˜ëŠ” ë°©ë²•
// // SMSTokenì´ userë„ ê°–ê³  ìˆë‹¤ê³  í•˜ë©´ ë¨
// // user ì˜ íƒ€ì…ì€ User ëª¨ë¸ì´ë‹¤
// // ì´ë ‡ê²Œ ì ê³  ì €ì¥í•˜ë©´ ì´ë ‡ê²Œ íŒŒì¼ì´ ìƒì„± ëœë‹¤
// // user       User     @relation(fields: [userId], references: [id])
// // userId     Int
// // ì´ê±´ ë¬´ìŠ¨ ëœ»ì´ëƒë©´
// // ì´ê±´ Prisma ê°€ user ë¥¼ ì—¬ê¸° ë³´ì´ëŠ” user       User ë°©ì‹ì´ ì•„ë‹ˆë¼
// // ì‹¤ì œë¡œ DB ì—ëŠ” userId     Int ì´ ê°’ì´ ì €ì¥ëœë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤
// // userId ë§Œì´ ì •ìˆ˜í˜•ìœ¼ë¡œ ì €ì¥ë  ê²ƒì´ë‹¤ 
// // í•˜ì§€ë§Œ ì‹¤ì œë¡œ DB ì—ì„œëŠ” SMSToken ì„ ìƒì„±í•˜ì§€ ì•Šì„ ê²ƒì´ë‹¤
// // ê·¸ë¦¬ê³  User ì•ˆì—ì„œ username ì´ë‚˜ email ì„ ê°€ì§„ ì‚¬ìš©ìë¥¼ ê°€ì§€ì§„ ì•Šì„ ê²ƒì´ë‹¤
// // ì´ëŸ°ì‹ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§„ ì•ŠìŒ
// // ëŒ€ì‹  DB ë ˆë²¨ì—ì„œ ì‹¤ì œë¡œ ì €ì¥ë˜ëŠ” ê°’ì€ userId     Int ì—¬ê¸° ìˆëŠ” ê°’ì´ ì €ì¥ë  ê²ƒì´ë‹¤
// // ì´ SMSToken ê³¼ ì—°ê²°ëœ userId ë§Œ ì €ì¥ë  ê²ƒì„
// // user       User     @relation(fields: [userId], references: [id])
// // ì´ê²ƒì€ Prisma ì™€ DB ì—ê²Œ ì´ userId ë¥¼ ì–´ë””ì„œ ì°¾ì•„ì•¼ í•  ì§€, ë˜ëŠ” ì´ userId ê°€ ë¬´ì—‡ì¸ì§€ ì•Œë ¤ì£¼ê¸° ìœ„í•´ì„œì´ë‹¤
// // ê·¸ë˜ì„œ ì´ê²ƒì€ @relation ê´€ê³„ë¼ê³  ì•Œë ¤ì£¼ëŠ” ê²ƒì´ë‹¤
// // ê·¸ë¦¬ê³  SMSToken ì˜ userId ë¼ëŠ” í•„ë“œê°€ userId ì´ í•„ë“œë¥¼ ë§í•˜ëŠ” ê²ƒì´ë‹¤
// // User ëª¨ë¸ì˜ id ë¼ëŠ” ê°’ì„ ì°¸ì¡°í•œë‹¤ëŠ” ê²ƒ

// // id         Int      @id @default(autoincrement())
// // created_at DateTime @default(now())
// // updated_at DateTime @updatedAt
// // userê°€ ì—†ëŠ” SMSTokenì€ ìˆì„ ìˆ˜ ì—†ë‹¤
// // user ì—†ì´ SMSTockenì„ ë§Œë“¤ ìˆ˜ëŠ” ì—†ë‹¤

// model SMSToken {
//   id         Int      @id @default(autoincrement())
//   token      String   @unique
//   created_at DateTime @default(now())
//   updated_at DateTime @updatedAt
//   user       User     @relation(fields: [userId], references: [id])
//   userId     Int
// }

// // âœ¨ğŸ™Œ schema.prisma íŒŒì¼ì„ ìˆ˜ì •í•  ë•Œë§ˆë‹¤ DBì—ê²Œ ì•Œë ¤ì¤˜ì•¼ í•œë‹¤
// // ê·¸ë¦¬ê³  Prisma Client ë¥¼ ë‹¤ ìƒì„±í•´ì•¼ í•œë‹¤
// // ê·¸ëŸ¼ ì´ê²Œ DB ì˜ ìµœì‹  ë²„ì „ìœ¼ë¡œ ì—…ë°ì´íŠ¸ ë  ê²ƒì„

//////////////////////////////////////////////////
// âœ… 2024 Prisma
// âœ… 7-5. onDelete 
// ğŸ”¶ onDelete 
// ì´ê±´ ê´€ê³„ë¥¼ ê°–ê³  ì‘ì—…ì„ í•  ë•Œ ê¼­ ì•Œì•„ì•¼ í•œë‹¤
// ì†ì„±ì„ í†µí•´ì„œ ì„œë¡œ ì—°ê´€ëœ ëª¨ë¸ì´ ì§€ì›Œì§ˆ ë•Œì˜ ë™ì‘ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model User {
  id         Int        @id @default(autoincrement())
  username   String     @unique
  email      String?    @unique
  password   String?
  phone      String?    @unique
  github_id  String?    @unique
  avatar     String? // @default("http://dkdkdkdkdk.com/dkd.jpg") ê¸°ë³¸ ê°’ ê°€ëŠ¥
  created_at DateTime   @default(now())
  updated_at DateTime   @updatedAt
  SMSToken   SMSToken[]
}

// âœ¨ ìš°ë¦¬ê°€ ì‚¬ìš©ìë¥¼ ì§€ìš°ì§€ ëª»í–ˆë˜ ì´ìœ ëŠ” 
// SMSToken ì´ id ê°€ 3ì¸ ì‚¬ìš©ìì™€ ì—°ê²°ë˜ì–´ ìˆê¸° ë•Œë¬¸ì´ë‹¤
// ë§Œì•½ ì‚¬ìš©ìë¥¼ ì‚­ì œí•œë‹¤ë©´ 
// SMSToken ì´ ë”ì´ìƒ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì‚¬ìš©ìì™€ ì—°ê²°ë  ê²ƒì´ë¼ëŠ” ëœ»ì´ë‹¤
// user ë¥¼ í•„ìˆ˜ ê°’ìœ¼ë¡œ ë§Œë“¤ì—ˆê¸° ë•Œë¬¸ì— ì´ê²ƒì€ ë¶ˆê°€ëŠ¥
// í•˜ì§€ë§Œ í•œ ê°€ì§€ ì„ íƒì´ ê°€ëŠ¥í•˜ë‹¤
// ë§Œì•½ ì‚¬ìš©ìê°€ ì‚­ì œëœë‹¤ë©´ SMSToken ì—ê²Œ ì–´ë–¤ ì¼ì´ ë°œìƒí• ì§€ ì„ íƒí•  ìˆ˜ ìˆë‹¤

// ğŸ”¶ onDelete ì†ì„±ì„ í†µí•´ì„œ 
// ì„œë¡œ ì—°ê´€ëœ ëª¨ë¸ì´ ì§€ì›Œì§ˆ ë•Œì˜ ë™ì‘ì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤

// ğŸ”¹ Cascade
// ê¸°ë³¸ì ìœ¼ë¡œ, ì‚¬ìš©ìê°€ ì‚­ì œëì„ ë•Œ ì‚¬ìš©ìì—ê²Œ ì—°ê²°ëœ ëª¨ë“  SMSTokenë“¤ë„ ê°™ì´ ì§€ì›Œì§„ë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤
// ê·¸ë˜ì„œ ì‚¬ìš©ìë¥¼ ì§€ìš°ë ¤ê³  í•œë‹¤ë©´, í•´ë‹¹ ì‚¬ìš©ìì™€ ê´€ë ¨ëœ ëª¨ë“  SMSTokenë„ ì‚­ì œ ë ê²ƒì„
// user ëŠ” requried ì—¬ì•¼ í•œë‹¤

// ğŸ”¹ SetNull
// ì´ê±´ ê°€ëŠ¥í•˜ë‹¤ë©´, ì‚¬ìš©ìê°€ ì‚­ì œëì„ ë•Œ SMSTokenì—ì„œ userë¥¼ nullë¡œ ì„¤ì •í•˜ëŠ” ê²ƒì„
// ì´ëŸ´ ë• User? Int? ì˜µì…”ë„ë¡œ ë§Œë“¤ì–´ì¤˜ì•¼í•œë‹¤ 
// ë”°ë¼ì„œ ì‚¬ìš©ìê°€ ê·¸ë“¤ì˜ ê³„ì •ì„ ì§€ìš°ë©´
// ê·¸ ì‚¬ìš©ìì˜ ëª¨ë“  SMSTokenë“¤ì´ userId ë¥¼ nullë¡œ ê°€ì§€ê²Œ ë  ê²ƒì„

// ğŸ”¹ Restrict
// ë¶€ëª¨ ë ˆì½”ë“œê°€ ì°¸ì¡°ë˜ê³  ìˆëŠ” ë™ì•ˆì€ ì‚­ì œë˜ëŠ” ê²ƒì„ ë§‰ëŠ”ë‹¤
// ë§Œì•½ SMSTokenì´ ì‚¬ìš©ìì™€ ì—°ê²°ë˜ì–´ ìˆë‹¤ë©´ ì‚¬ìš©ìë¥¼ ì§€ìš¸ ìˆ˜ ì—†ë‹¤
// ê·¸ ì „ì— ëª¨ë“  SMSTokenì„ ì‚­ì œí•´ì•¼ì§€ë§Œ ì‚¬ìš©ìë¥¼ ì§€ìš¸ ìˆ˜ ìˆë‹¤

model SMSToken {
  id         Int      @id @default(autoincrement())
  token      String   @unique
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId     Int
}
